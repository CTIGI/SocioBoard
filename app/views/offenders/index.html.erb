<%= render partial: "offenders/partials/search" %>
<%= render partial: "offenders/partials/show_results" %>

<div class="row">
  <%= link_to offenders_path({ q: { measures_near_due_date_true: 1} }) do %>
    <div class="col-md-5 subtitle-panel" data-trigger="hover" data-toggle="popover" data-placement="right" data-content="<%= I18n.t('views.offenders.subtitle.text', date: l(Date.today + 10))%>" title="<%= I18n.t('views.offenders.subtitle.title') %>" data-original-title="">
      <span class="subtitle bad bad-subtitle">&nbsp;</span>
      <b><%= "#{I18n.t('views.offenders.subtitle.title')} (#{@near_due_date_counter})"%></b>
    </div>
  <% end %>
</div>

<table class="table">
  <thead>
    <tr>
      <th>
        <%= t('activerecord.attributes.offender.unit') %>
      </th>
      <th>
        <%= t('activerecord.attributes.offender.name') %>
      </th>
      <th>
        <%= t('activerecord.attributes.offender.age') %>
      </th>
      <th>
        <%= t('activerecord.attributes.offender.recurrent') %>
      </th>
      <th>
        <%= t('activerecord.attributes.offender.origin_county') %>
      </th>
      <th>
        <%= t('activerecord.attributes.offender.article') %>
      </th>
      <th>
        <%= t('activerecord.attributes.offender.measures_measure_type') %>
      </th>
      <th>
        <%= t('activerecord.attributes.offender.measures_measure_deadline') %>
      </th>
      <th>
        <%= t('activerecord.attributes.offender.measure_dates') %>
      </th>
    </tr>
  </thead>
  <tbody>
    <% @offenders.each do |offender| %>
      <tr class="<%= near_due_date(measure_data(offender, :near_due_date)) %>">
        <td>
          <%= truncate_words(offender.unit) %>
        </td>
        <td>
          <%= truncate(offender.name) %>
        </td>
        <td>
          <%= show_field(offender.age) %>
        </td>
        <td>
          <%= show_field(offender.recurrent) %>
        </td>
        <td>
          <%= show_field(offender.origin_county) %>
        </td>
        <td>
          <%= show_field(offender.crimes.pluck(:name).join(", ")) %>
        </td>
        <td>
          <b><%= UnicodeUtils.upcase(measure_data(offender, :measure_type)) %></b>
          <br/>
          (<%= measure_data(offender, :measure_situation) %>)
        </td>
        <td>
          <%= measure_data(offender, :measure_deadline) %>
        </td>
        <td data-trigger="hover" data-toggle="popover" data-container="body"
            data-placement="top" data-content='<%= measure_data(offender, :ammount_end_days) %>'
            title='<%= t('activerecord.attributes.offender.ammount_end_days')%>'>
          <%= l(measure_data(offender, :start_date_measure).to_date) %>
          <%= l(measure_data(offender, :end_date_measure).to_date) %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="text-center">
  <%= paginate @offenders %>
</div>
